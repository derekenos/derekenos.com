<html lang="en">

  <head>
    <meta charset="utf-8">
    <title>Gritty Viddy</title>

    <!-- Include gpu.js -->
    <script src="https://unpkg.com/gpu.js@latest/dist/gpu-browser.min.js">
    </script>

  <script type="text/javascript">/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./components/GrittyViddy.js");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./components/Base.js":
/*!****************************!*\
  !*** ./components/Base.js ***!
  \****************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return Base; });\n/*\n   Subclass of HTMLElement that attaches a shadow root and style element.\n */\n\nclass Base extends HTMLElement {\n  constructor () {\n    super()\n    this.shadow = this.attachShadow({ mode: \"open\" })\n  }\n\n  connectedCallback (STYLE = \"\") {\n    const style = document.createElement(\"style\")\n    style.textContent = STYLE\n    this.shadow.appendChild(style)\n  }\n}\n\n\n//# sourceURL=webpack:///./components/Base.js?");

/***/ }),

/***/ "./components/Controls.js":
/*!********************************!*\
  !*** ./components/Controls.js ***!
  \********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return Controls; });\n/* harmony import */ var _Base_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Base.js */ \"./components/Base.js\");\n/* harmony import */ var _FilterRow_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./FilterRow.js */ \"./components/FilterRow.js\");\n/* harmony import */ var _lib_constants_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/constants.js */ \"./lib/constants.js\");\n/* harmony import */ var _lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../lib/domHelpers.js */ \"./lib/domHelpers.js\");\n/* harmony import */ var _lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/pubSub.js */ \"./lib/pubSub.js\");\n/* harmony import */ var _lib_utils_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../lib/utils.js */ \"./lib/utils.js\");\n\n\n\n\n\n\n\n\n\nconst STYLE = `\n  button,\n  select {\n    background-color: rgba(64, 64, 64, .8);\n    color: #fff;\n    border: none;\n    padding: 8px 14px;\n    font-size: 1.2rem;\n    cursor: pointer;\n  }\n\n  /* Remove the <select> button.\n     https://stackoverflow.com/a/20464860/2327940\n   */\n  select {\n    -webkit-appearance: none;\n    -moz-appearance: none;\n    text-indent: 1px;\n    text-overflow: '';\n  }\n\n  button:hover {\n    background-color: rgba(100, 100, 100, .8);\n    color: #fff;\n  }\n\n  ol {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n  }\n\n  .wrapper {\n    display: flex;\n  }\n\n  .wrapper > * {\n    margin: 0 4px;\n  }\n\n  .wrapper > div {\n    display: inline-block;\n  }\n\n  .wrapper > div:first-child {\n    flex-grow: 1;\n    margin-left: 0;\n  }\n\n  .wrapper > div:last-child {\n    margin-right: 0;\n  }\n\n  .filters {\n  }\n\n  .filters > div {\n    margin-top: 1rem;\n    margin-left: 1rem;\n    opacity: 0;\n    transition: opacity .25s;\n  }\n\n  .filters > div.visible {\n    opacity: 1;\n  }\n\n  .feed.active {\n    background-color: #f50;\n  }\n\n  .record.recording,\n  .record.recording:hover {\n    background-color: rgba(255, 0, 0, 1);\n    color: #fff;\n  }\n`\n\n\nclass Controls extends _Base_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n  constructor () {\n    super()\n    this.filters = []\n    this.feedDeviceIds = []\n  }\n\n  connectedCallback () {\n    super.connectedCallback(STYLE)\n\n    this.wrapper = Object(_lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_3__[\"Element\"])(\n      `<div class=\"wrapper\">\n         <div class=\"filters\">\n           <button>Hide Filters</button>\n           <div class=\"visible\">\n             <select class=\"filter-preset\">\n               <option value=\"\">Preset: none</option>\n               ${ _lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"FILTER_PRESET_NAMES\"].map((k, i) =>\n                    `<option value=\"${k}\"${i === 0 ? \" selected\" : \"\"}>Preset: ${k}</option>`\n                  ).join('\\n') }\n             </select>\n             <ol></ol>\n             <button class=\"add-filter\">Add Filter</button>\n           </div>\n         </div>\n\n         <div class=\"feeds-wrapper\">\n           <span class=\"feeds\"></span>\n           <button class=\"add-feed\">+</button>\n         </div>\n\n         <div><button class=\"record\">Record</button></div>\n         <div><button class=\"fullscreen\">&#8644;</button></div>\n       </div>\n      `\n    )\n    this.shadow.appendChild(this.wrapper)\n\n    // Define the Filters button click handler.\n    this.wrapper.querySelector(\".filters > button\").addEventListener(\"click\", e => {\n      const filtersDiv = this.wrapper.querySelector(\".filters > div\")\n      filtersDiv.classList.toggle(\"visible\")\n      e.target.innerText = `${filtersDiv.classList.contains(\"visible\") ? \"Hide\" : \"Show\"} Filters`\n    })\n\n    // Define the button click handlers.\n    this.wrapper.querySelector(\".fullscreen\")\n      .addEventListener(\"click\", () => Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"publish\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].FULLSCREEN_TOGGLE))\n\n    this.wrapper.querySelector(\".record\")\n      .addEventListener(\"click\", this.recordClickHandler.bind(this))\n\n    this.wrapper.querySelector(\".add-feed\")\n      .addEventListener(\"click\", () => Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"publish\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].ADD_FEED))\n\n    // Allow fullscreen to be controlled by the \"f\" key and number keys to select feed.\n    window.addEventListener(\"keydown\", e => {\n      if (e.key === \"f\") {\n        Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"publish\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].FULLSCREEN_TOGGLE)\n        return\n      }\n      const feedNum = parseInt(e.key)\n      if (!Number.isNaN(feedNum) &&\n          feedNum <= this.wrapper.querySelector(\".feeds\").children.length) {\n        Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"publish\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].SWITCH_FEED, feedNum)\n        this.switchFeedHandler(feedNum)\n      }\n    })\n\n    // Define a preset change handler.\n    const filterPreset = this.wrapper.querySelector(\".filter-preset\")\n    filterPreset.addEventListener(\"change\", e => {\n      const presetName = e.target.value\n      Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"publish\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].PRESET_CHANGE, presetName)\n      if (presetName) {\n        this.filters = _lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"FILTER_PRESETS\"].get(presetName)\n        this.renderFilters()\n      }\n    })\n\n    // Render the default preset.\n    this.filters = _lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"FILTER_PRESETS\"].get(filterPreset.value)\n    this.renderFilters()\n\n    this.wrapper.querySelector(\".feeds\")\n      .addEventListener(\"click\", this.feedClickHandler.bind(this))\n\n    this.wrapper.querySelector(\".add-filter\")\n      .addEventListener(\"click\", this.addFilter.bind(this))\n\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].FILTER_CHANGE, this.filterChangeHandler.bind(this))\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].PARAMS_UPDATE, this.paramValueUpdateHandler.bind(this))\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].REMOVE_FILTER, this.removeFilterHandler.bind(this))\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].MOVE_FILTER_UP, this.moveFilterUpHandler.bind(this))\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].MOVE_FILTER_DOWN, this.moveFilterDownHandler.bind(this))\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].FEED_ADDED, this.feedAddedHandler.bind(this))\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].SWITCH_FEED, this.switchFeedHandler.bind(this))\n  }\n\n  addFilter () {\n    // Find the current max filterId.\n    const maxId = this.filters.reduce((maxId, [ id ]) => Math.max(maxId, id), -1)\n    const filter = [ maxId + 1, \"brightness\", { factor: 1 } ]\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"publish\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].ADD_FILTER, filter)\n    this.filters.push(filter)\n    this.renderFilters()\n  }\n\n  feedClickHandler (e) {\n    const target = e.target\n    if (!target.classList.contains(\"active\")) {\n      const feedNum = parseInt(target.dataset.feedNum)\n      Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"publish\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].SWITCH_FEED, feedNum)\n      this.switchFeedHandler(feedNum)\n    }\n  }\n\n  renderFilters () {\n    // (re)Render the filters list.\n    const filtersEl = this.wrapper.querySelector(\"ol\")\n    // Remove all existing filter rows.\n    Array.from(filtersEl.children).forEach(x => x.remove())\n    // Add all the current rows.\n    this.filters.forEach(([ filterId, filterName, filterParams ]) => {\n      const filterRow = Object(_lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_3__[\"Element\"])(\n        `<filter-row name=\"${filterName}\" filterId=\"${filterId}\"></filter-row>`\n      )\n      for (let [k, v] of Object.entries(filterParams)) {\n        filterRow.dataset[k] = v\n      }\n      filtersEl.appendChild(filterRow)\n    })\n  }\n\n  recordClickHandler (e) {\n    const target = e.target\n    if (target.textContent === \"Record\") {\n      Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"publish\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].RECORD_START)\n      target.textContent = \"Stop\"\n      target.classList.add(\"recording\")\n    } else {\n      Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"publish\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].RECORD_STOP)\n      target.textContent = \"Record\"\n      target.classList.remove(\"recording\")\n    }\n  }\n\n  filterChangeHandler ([ filterId, newFilterName ]) {\n    const [ filter, i ] = Object(_lib_utils_js__WEBPACK_IMPORTED_MODULE_5__[\"getFilterById\"])(this.filters, filterId)\n    const [ ,, params ] = this.filters[i]\n    this.filters[i][1] = newFilterName\n    // Set the default params.\n    this.filters[i][2] = _lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"FILTER_NAME_PARAM_DEFAULT_MAP\"].get(newFilterName)\n    // Clear preset selection.\n    this.shadow.querySelector(\"select.filter-preset\").value = \"\"\n    this.renderFilters()\n  }\n\n  paramValueUpdateHandler ([ filterId, name, value ]) {\n    // Update the local filter param and publish the new filters.\n    const [ filter ] = Object(_lib_utils_js__WEBPACK_IMPORTED_MODULE_5__[\"getFilterById\"])(this.filters, filterId)\n    if (!filter) {\n      return\n    }\n    const [ ,, params ] = filter\n    params[name] = value\n    // Clear preset selection.\n    this.shadow.querySelector(\"select.filter-preset\").value = \"\"\n  }\n\n  removeFilterHandler (filterId) {\n    const [ filter, i ] = Object(_lib_utils_js__WEBPACK_IMPORTED_MODULE_5__[\"getFilterById\"])(this.filters, filterId)\n    if (filter) {\n      this.filters.splice(i, 1)\n      this.renderFilters()\n    }\n    // Clear preset selection.\n    this.shadow.querySelector(\"select.filter-preset\").value = \"\"\n  }\n\n  moveFilterUpHandler (filterId) {\n    const [ filter, i ] = Object(_lib_utils_js__WEBPACK_IMPORTED_MODULE_5__[\"getFilterById\"])(this.filters, filterId)\n    if (i > 0) {\n      this.filters.splice(i, 1)\n      this.filters.splice(i - 1, 0, filter)\n      this.renderFilters()\n    }\n    // Clear preset selection.\n    this.shadow.querySelector(\"select.filter-preset\").value = \"\"\n  }\n\n  moveFilterDownHandler (filterId) {\n    const [ filter, i ] = Object(_lib_utils_js__WEBPACK_IMPORTED_MODULE_5__[\"getFilterById\"])(this.filters, filterId)\n    if (i < this.filters.length - 1) {\n      this.filters.splice(i, 1)\n      this.filters.splice(i + 1, 0, filter)\n      this.renderFilters()\n    }\n    // Clear preset selection.\n    this.shadow.querySelector(\"select.filter-preset\").value = \"\"\n  }\n\n  feedAddedHandler (deviceId) {\n    const feeds = this.shadow.querySelector(\".feeds\")\n    const feedNum = feeds.children.length + 1\n    feeds.appendChild(\n      Object(_lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_3__[\"Element\"])(\n        `<div>\n           <button class=\"feed\" data-feed-num=\"${feedNum}\">\n             Feed ${feedNum}\n           </button>\n         </div>\n        `\n      )\n    )\n  }\n\n  switchFeedHandler (num) {\n    // Set the active style on the specified feed.\n    const currentActive = this.shadow.querySelector(\".feeds button.active\")\n    if (currentActive) {\n      currentActive.classList.remove(\"active\")\n    }\n    this.shadow.querySelector(`.feeds > div:nth-child(${num}) button`)\n      .classList.add(\"active\")\n  }\n\n}\n\n\ncustomElements.define(\"con-trols\", Controls)\n\n\n//# sourceURL=webpack:///./components/Controls.js?");

/***/ }),

/***/ "./components/FilterRow.js":
/*!*********************************!*\
  !*** ./components/FilterRow.js ***!
  \*********************************/
/*! exports provided: FilterParam, default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FilterParam\", function() { return FilterParam; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return FilterRow; });\n/* harmony import */ var _Base_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Base.js */ \"./components/Base.js\");\n/* harmony import */ var _ImageProcessor_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ImageProcessor.js */ \"./components/ImageProcessor.js\");\n/* harmony import */ var _lib_constants_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/constants.js */ \"./lib/constants.js\");\n/* harmony import */ var _lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../lib/domHelpers.js */ \"./lib/domHelpers.js\");\n/* harmony import */ var _lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/pubSub.js */ \"./lib/pubSub.js\");\n\n\n\n\n\n\n\n\nconst FILTER_PARAM_STYLE = maxContentRems => `\n  .wrapper {\n    display: inline-block;\n    position: relative;\n    background-color: rgba(64, 64, 64, .8);\n    color: #fff;\n    padding: calc(8px + 1rem) 14px 8px 14px;\n  }\n\n  textarea {\n    background-color: transparent;\n    border: none;\n    color: #fff;\n    font-size: 1rem;\n    cursor: text;\n    padding: 0;\n    width: calc(${Math.max(maxContentRems, 5)}rem - 28px);\n    height: 1rem;\n  }\n\n  label {\n    position: absolute;\n    font-size: .8rem;\n    top: .2rem;\n    font-weight: normal;\n  }\n`\n\n\nclass FilterParam extends _Base_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n  connectedCallback () {\n    const filterId = this.getAttribute(\"filterId\")\n    const name = this.getAttribute(\"name\")\n    const value = this.getAttribute(\"value\")\n    const maxContentRems = Math.floor(Math.max(name.length * .8, value.length * .8))\n\n    super.connectedCallback(FILTER_PARAM_STYLE(maxContentRems))\n\n    const el = Object(_lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_3__[\"Element\"])(\n      `<span class=\"wrapper\">\n         <label>${name}</label>\n         <textarea name=\"${name}\" filterId=\"${filterId}\">${value}</textarea>\n       </span>\n      `\n    )\n    this.shadow.appendChild(el)\n\n    // Select the textarea text on focus.\n    el.querySelector(\"textarea\").addEventListener(\"focus\", e => {\n      e.target.select()\n    })\n\n    this.shadow.addEventListener(\"input\", this.paramValueChangeHandler)\n    // Stop keypress propagation to prevent trigger shortcuts when\n    // editing text fields.\n    this.shadow.addEventListener(\"keydown\", e => e.stopPropagation())\n  }\n\n  paramValueChangeHandler (e) {\n    const param = e.target\n    const filterId = parseInt(param.getAttribute(\"filterId\"))\n    const name = param.getAttribute(\"name\")\n    const value = param.value\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"publish\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].PARAMS_UPDATE, [ filterId, name, value ])\n  }\n\n}\n\n\ncustomElements.define(\"filter-param\", FilterParam)\n\n\nconst FILTER_ROW_STYLE = `\n  button,\n  select,\n  input {\n    background-color: rgba(64, 64, 64, .8);\n    color: #fff;\n    border: none;\n    padding: 8px 14px;\n    font-size: 1.2rem;\n    cursor: pointer;\n    margin: .5rem 0;\n  }\n\n  /* Remove the <select> button.\n     https://stackoverflow.com/a/20464860/2327940\n   */\n  select {\n    -webkit-appearance: none;\n    -moz-appearance: none;\n    text-indent: 1px;\n    text-overflow: '';\n  }\n\n  button:hover {\n    background-color: rgba(100, 100, 100, .8);\n    color: #fff;\n  }\n`\n\n\nclass FilterRow extends _Base_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n  connectedCallback () {\n    super.connectedCallback(FILTER_ROW_STYLE)\n\n    const name = this.getAttribute(\"name\")\n    const filterId = this.getAttribute(\"filterId\")\n\n    const el = Object(_lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_3__[\"Element\"])(\n      `<li filterId=\"${filterId}\">\n         <button class=\"remove\">x</button>\n         <button class=\"move-up\">&uarr;</button>\n         <button class=\"move-down\">&darr;</button>\n         <select class=\"filter\">\n           <option value=\"threshold\">Threshold</option>\n           <option value=\"brightness\">Brightness</option>\n           <option value=\"channel\">Channel</option>\n           <option value=\"colorGain\">Color Gain</option>\n           <option value=\"colorReducer\">Color Reducer</option>\n           <option value=\"rowBlanker\">Row Blanker</option>\n           <option value=\"colBlanker\">Column Blanker</option>\n           <option value=\"invert\">Invert</option>\n           <option value=\"audioPlot\">Audio Plot</option>\n           <option value=\"flipHorizontal\">Flip Horizontal</option>\n           <option value=\"verticalMirror\">Vertical Mirror</option>\n           <option value=\"horizontalMirror\">Horizontal Mirror</option>\n           <option value=\"blur\">Blur</option>\n           <option value=\"panZoom\">Pan / Zoom</option>\n         </select>\n         <span class=\"filter-params\"></span>\n       </li>\n      `, \"ol\"\n    )\n    // Select the option that matches the name property.\n    el.querySelector(`option[value=\"${name}\"]`).selected = true\n\n    // Read the params from dataset and add the filter-param elements.\n    const filterParams = el.querySelector(\".filter-params\")\n    for (let paramName of _ImageProcessor_js__WEBPACK_IMPORTED_MODULE_1__[\"FILTER_NAME_PARAM_KEY_ARR_POS_MAP\"].get(name)) {\n      filterParams.appendChild(Object(_lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_3__[\"Element\"])(\n        `<filter-param filterId=\"${filterId}\" name=\"${paramName}\"\n                       value=\"${this.dataset[paramName]}\">\n         </filter-param>\n        `\n      ))\n    }\n    this.shadow.appendChild(el)\n\n    // Register the click handler.\n    this.shadow.addEventListener(\"click\", this.buttonHandler)\n\n    // Publish filter select element changes.\n    el.querySelector(\"select.filter\").addEventListener(\"change\", e => {\n      const target = e.target\n      const filterId = parseInt(target.parentElement.getAttribute(\"filterId\"))\n      Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"publish\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].FILTER_CHANGE, [ filterId, target.value ])\n    })\n  }\n\n  buttonHandler (e) {\n    const target = e.target\n    if (target.tagName !== \"BUTTON\") {\n      return\n    }\n    const filterId = parseInt(target.parentElement.getAttribute(\"filterId\"))\n    let topic\n    if (target.classList.contains(\"remove\")) {\n      topic = _lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].REMOVE_FILTER\n    } else if (target.classList.contains(\"move-up\")) {\n      topic = _lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].MOVE_FILTER_UP\n    } else if (target.classList.contains(\"move-down\")) {\n      topic = _lib_constants_js__WEBPACK_IMPORTED_MODULE_2__[\"TOPICS\"].MOVE_FILTER_DOWN\n    }\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_4__[\"publish\"])(topic, filterId)\n  }\n}\n\n\ncustomElements.define(\"filter-row\", FilterRow)\n\n\n//# sourceURL=webpack:///./components/FilterRow.js?");

/***/ }),

/***/ "./components/GrittyViddy.js":
/*!***********************************!*\
  !*** ./components/GrittyViddy.js ***!
  \***********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return GrittyViddy; });\n/* harmony import */ var _Base_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Base.js */ \"./components/Base.js\");\n/* harmony import */ var _Controls_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Controls.js */ \"./components/Controls.js\");\n/* harmony import */ var _ImageProcessor_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ImageProcessor.js */ \"./components/ImageProcessor.js\");\n/* harmony import */ var _VideoCanvas_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./VideoCanvas.js */ \"./components/VideoCanvas.js\");\n/* harmony import */ var _lib_audio_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/audio.js */ \"./lib/audio.js\");\n/* harmony import */ var _lib_canvasRecorder_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../lib/canvasRecorder.js */ \"./lib/canvasRecorder.js\");\n/* harmony import */ var _lib_constants_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../lib/constants.js */ \"./lib/constants.js\");\n/* harmony import */ var _lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../lib/domHelpers.js */ \"./lib/domHelpers.js\");\n/* harmony import */ var _lib_pubSub_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../lib/pubSub.js */ \"./lib/pubSub.js\");\n/* harmony import */ var _lib_utils_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../lib/utils.js */ \"./lib/utils.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\nconst STYLE = `\n  .wrapper {\n    position: relative;\n  }\n\n  video-canvas {\n    position: absolute;\n    z-index: 0;\n  }\n\n  image-processor {\n    position: absolute;\n    z-index: 1;\n    width: 100%;\n  }\n\n  con-trols {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    z-index: 2;\n  }\n`\n\n\nclass GrittyViddy extends _Base_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n  async connectedCallback () {\n    super.connectedCallback(STYLE)\n\n    this.videoWidth = parseInt(this.getAttribute(\"width\") || \"1280\")\n    this.videoHeight = parseInt(this.getAttribute(\"height\") || \"720\")\n    const noGPU = this.hasAttribute(\"no-gpu\")\n\n    this.wrapper = Object(_lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_7__[\"Element\"])(`<div class=\"wrapper\"></div>`)\n    this.shadow.appendChild(this.wrapper)\n\n    this.controls = Object(_lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_7__[\"Element\"])(`<con-trols></con-trols>`)\n    this.wrapper.appendChild(this.controls)\n\n    // Initialize the first VideoCanvas.\n    this.videoCanvases = []\n    await this.addFeedHandler()\n    this.activeVideoCanvasIndex = 0\n\n    // Initialize the ImageProcessor.\n    this.imageProcessor = Object(_lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_7__[\"Element\"])(\n      `<image-processor ${noGPU ? \"no-gpu \" : \"\"}\n                        width=\"${this.videoWidth}\" height=\"${this.videoHeight}\">\n       </image-processor>\n      `\n    )\n    this.wrapper.appendChild(this.imageProcessor)\n\n    // Initialize the canvas recorder.\n    this.recorder = new _lib_canvasRecorder_js__WEBPACK_IMPORTED_MODULE_5__[\"default\"](\n      this.imageProcessor.canvas,\n      this.videoCanvases[0].audioTrack,\n    )\n\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_8__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_6__[\"TOPICS\"].FULLSCREEN_TOGGLE, this.toggleFullscreen.bind(this))\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_8__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_6__[\"TOPICS\"].ADD_FEED, this.addFeedHandler.bind(this))\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_8__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_6__[\"TOPICS\"].SWITCH_FEED, this.switchFeedHandler.bind(this))\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_8__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_6__[\"TOPICS\"].RECORD_START, () => this.recorder.start())\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_8__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_6__[\"TOPICS\"].RECORD_STOP, () => this.recorder.stop())\n\n    // Create an audio buffer for realtime sampling.\n    this.audioBuffer = new Uint8Array(this.videoCanvases[0].audioAnalyser.fftSize)\n\n    // Start processing frames.\n    requestAnimationFrame(this.processFrame.bind(this))\n  }\n\n  processFrame () {\n    const { loudness, samples } = Object(_lib_audio_js__WEBPACK_IMPORTED_MODULE_4__[\"getAudioParams\"])(\n      this.videoCanvases[0].audioAnalyser,\n      this.audioBuffer,\n      this.videoWidth\n    )\n    const imageData = this\n      .videoCanvases[this.activeVideoCanvasIndex]\n      .captureFrame()\n    this.imageProcessor.process(imageData, { loudness, samples })\n    requestAnimationFrame(this.processFrame.bind(this))\n  }\n\n  getNextFilterId () {\n    // Return a monotonically increasing integer to serve as filter ID.\n    this.nextFilterId += 1\n    return this.nextFilterId\n  }\n\n  async toggleFullscreen () {\n    if (document.fullscreenElement !== null) {\n      document.exitFullscreen()\n    } else {\n      this.wrapper.requestFullscreen()\n    }\n  }\n\n  async switchFeedHandler (num) {\n    this.activeVideoCanvasIndex = num - 1\n  }\n\n  async addFeedHandler () {\n    // Add a new device feed.\n    // Get the deviceId values of the current feeds.\n    const activeDeviceIds = this.videoCanvases.map(x => x.deviceId)\n\n    // Request the first of the available, inactive devices.\n    const videoDevices = Array.from(\n      await navigator.mediaDevices.enumerateDevices()\n    ).filter(x => x.kind === \"videoinput\" && !activeDeviceIds.includes(x.deviceId))\n\n    if (videoDevices.length > 0) {\n      // Request access to the first one but the user can select whatever they want\n      // in the browser prompt.\n      const videoCanvas = Object(_lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_7__[\"Element\"])(\n        `<video-canvas deviceId=${videoDevices[0].deviceId}\n                       width=\"${this.videoWidth}\"\n                       height=\"${this.videoHeight}\">\n         </video-canvas>\n        `\n      )\n      this.videoCanvases.push(videoCanvas)\n      this.wrapper.appendChild(videoCanvas)\n      Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_8__[\"publish\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_6__[\"TOPICS\"].FEED_ADDED)\n      const feedNum = this.videoCanvases.length\n      Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_8__[\"publish\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_6__[\"TOPICS\"].SWITCH_FEED, feedNum)\n      this.switchFeedHandler(feedNum)\n    }\n  }\n}\n\n\ncustomElements.define(\"gritty-viddy\", GrittyViddy)\n\n\n//# sourceURL=webpack:///./components/GrittyViddy.js?");

/***/ }),

/***/ "./components/ImageProcessor.js":
/*!**************************************!*\
  !*** ./components/ImageProcessor.js ***!
  \**************************************/
/*! exports provided: FILTER_NAME_PARAM_KEY_ARR_POS_MAP, default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FILTER_NAME_PARAM_KEY_ARR_POS_MAP\", function() { return FILTER_NAME_PARAM_KEY_ARR_POS_MAP; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return ImageProcessor; });\n/* harmony import */ var _Base_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Base.js */ \"./components/Base.js\");\n/* harmony import */ var _lib_constants_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/constants.js */ \"./lib/constants.js\");\n/* harmony import */ var _lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../lib/domHelpers.js */ \"./lib/domHelpers.js\");\n/* harmony import */ var _lib_filters_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../lib/filters.js */ \"./lib/filters.js\");\n/* harmony import */ var _lib_gpuFilters_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../lib/gpuFilters.js */ \"./lib/gpuFilters.js\");\n/* harmony import */ var _lib_pubSub_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../lib/pubSub.js */ \"./lib/pubSub.js\");\n/* harmony import */ var _lib_utils_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../lib/utils.js */ \"./lib/utils.js\");\n\n\n\n\n\n\n\n\n\n\nconst STYLE = `\n  canvas {\n    width: 100%;\n  }\n`\n\n\n// The filter functions need params to be a positionally-mapped array of\n// scalars because that's what gpu.js can deal with, but UI-wise, it's better\n// for us to deal in named parameters, so this maps the param names to their\n// array position so that we can do the translation on filter function call.\nconst FILTER_NAME_PARAM_KEY_ARR_POS_MAP = new Map([\n  [ \"threshold\", [ \"threshold\" ] ],\n  [ \"brightness\", [ \"factor\" ] ],\n  [ \"channel\", [ \"r\", \"g\", \"b\" ] ],\n  [ \"colorGain\", [ \"r\", \"g\", \"b\" ] ],\n  [ \"colorReducer\", [ \"mask\" ] ],\n  [ \"rowBlanker\", [ \"nth\" ] ],\n  [ \"colBlanker\", [ \"nth\" ] ],\n  [ \"invert\", [ ] ],\n  [ \"audioPlot\", [ ] ],\n  [ \"flipHorizontal\", [ ] ],\n  [ \"verticalMirror\", [ ] ],\n  [ \"horizontalMirror\", [ ] ],\n  [ \"blur\", [ \"level\" ] ],\n  [ \"panZoom\", [ \"x\", \"y\", \"zoom\" ] ],\n])\n\n\n// Return the object-type filter function params as a positionally mapped array.\nconst paramsObjectToArray = (filterName, paramsObj) =>\n  FILTER_NAME_PARAM_KEY_ARR_POS_MAP.get(filterName).map(k => paramsObj[k])\n\n\nfunction evalParamsArr (paramsArr, { loudness, samples }) {\n  // Attempt to eval the parameter array strings to interpolate loudness/samples\n  // and convert to a float.\n  const finalArr = []\n  paramsArr.forEach(s => {\n    let evalResult\n    try {\n      evalResult = parseFloat(eval(s))\n    } catch (e) {\n    }\n    if (!(typeof evalResult === \"number\") || Number.isNaN(evalResult)) {\n      throw new Error(`eval did not yield number on: ${s}`)\n    }\n    finalArr.push(evalResult)\n  })\n  return finalArr\n}\n\n\nclass ImageProcessor extends _Base_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n  constructor () {\n    super()\n    this.useGPU = false\n    this.filters = []\n  }\n\n  connectedCallback () {\n    super.connectedCallback(STYLE)\n\n    this.width = parseInt(this.getAttribute(\"width\") || \"1280\")\n    this.height = parseInt(this.getAttribute(\"height\") || \"720\")\n    this.useGPU = !this.hasAttribute(\"no-gpu\")\n\n    this.wrapper = Object(_lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_2__[\"Element\"])(`<div></div>`)\n    this.shadowRoot.appendChild(this.wrapper)\n\n    this.canvas = Object(_lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_2__[\"Element\"])(\n      `<canvas width=\"${this.width}\" height=\"${this.height}\">\n       </canvas>\n      `\n    )\n    this.canvasCtx = this.canvas.getContext(\"2d\")\n    this.wrapper.appendChild(this.canvas)\n\n    // Select the Default preset.\n    this.presetChangeHandler(\"Default\")\n\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_5__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_1__[\"TOPICS\"].FILTER_CHANGE, this.filterChangeHandler.bind(this))\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_5__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_1__[\"TOPICS\"].PARAMS_UPDATE, this.paramValueUpdateHandler.bind(this))\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_5__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_1__[\"TOPICS\"].REMOVE_FILTER, this.removeFilterHandler.bind(this))\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_5__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_1__[\"TOPICS\"].MOVE_FILTER_UP, this.moveFilterUpHandler.bind(this))\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_5__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_1__[\"TOPICS\"].MOVE_FILTER_DOWN, this.moveFilterDownHandler.bind(this))\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_5__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_1__[\"TOPICS\"].PRESET_CHANGE, this.presetChangeHandler.bind(this))\n    Object(_lib_pubSub_js__WEBPACK_IMPORTED_MODULE_5__[\"subscribe\"])(_lib_constants_js__WEBPACK_IMPORTED_MODULE_1__[\"TOPICS\"].ADD_FILTER, this.addFilterHandler.bind(this))\n  }\n\n  getFilterByName (name) {\n    return (this.useGPU ? _lib_gpuFilters_js__WEBPACK_IMPORTED_MODULE_4__ : _lib_filters_js__WEBPACK_IMPORTED_MODULE_3__)[`${name}Filter`]\n  }\n\n  convertIncomingFilter (filter) {\n    // Convert the incoming filter to an internal array that includes the\n    // function object itself and a params object converted to an array.\n    const [ filterId, filterName, filterParamsObj ] = filter\n    const filterFn = this.getFilterByName(filterName)\n    const filterParamsArr = paramsObjectToArray(filterName, filterParamsObj)\n    return [ filterId, filterName, filterFn, filterParamsArr ]\n  }\n\n  filterChangeHandler ([ filterId, newFilterName ]) {\n    const [ filter, i ] = Object(_lib_utils_js__WEBPACK_IMPORTED_MODULE_6__[\"getFilterById\"])(this.filters, filterId)\n    const [ ,,, params ] = this.filters[i]\n    const filterFn = this.getFilterByName(newFilterName)\n    const paramsArr = paramsObjectToArray(\n      newFilterName,\n      _lib_constants_js__WEBPACK_IMPORTED_MODULE_1__[\"FILTER_NAME_PARAM_DEFAULT_MAP\"].get(newFilterName)\n    )\n    this.filters[i] = [ filterId, newFilterName, filterFn, paramsArr ]\n  }\n\n  presetChangeHandler (presetName) {\n    if (presetName) {\n      this.filters = _lib_constants_js__WEBPACK_IMPORTED_MODULE_1__[\"FILTER_PRESETS\"].get(presetName).map(\n        this.convertIncomingFilter.bind(this)\n      )\n    }\n  }\n\n  paramValueUpdateHandler ([ filterId, name, value ]) {\n    // Update the local filter param and publish the new filters.\n    const [ filter ] = Object(_lib_utils_js__WEBPACK_IMPORTED_MODULE_6__[\"getFilterById\"])(this.filters, filterId)\n    if (!filter) {\n      return\n    }\n    const [, filterName,, paramsArr ] = filter\n    // Find param index.\n    const i = FILTER_NAME_PARAM_KEY_ARR_POS_MAP.get(filterName).indexOf(name)\n    paramsArr[i] = value\n  }\n\n  removeFilterHandler (filterId) {\n    const [ filter, i ] = Object(_lib_utils_js__WEBPACK_IMPORTED_MODULE_6__[\"getFilterById\"])(this.filters, filterId)\n    this.filters.splice(i, 1)\n  }\n\n  moveFilterUpHandler (filterId) {\n    const [ filter, i ] = Object(_lib_utils_js__WEBPACK_IMPORTED_MODULE_6__[\"getFilterById\"])(this.filters, filterId)\n    if (i > 0) {\n      this.filters.splice(i, 1)\n      this.filters.splice(i - 1, 0, filter)\n    }\n  }\n\n  moveFilterDownHandler (filterId) {\n    const [ filter, i ] = Object(_lib_utils_js__WEBPACK_IMPORTED_MODULE_6__[\"getFilterById\"])(this.filters, filterId)\n    if (i < this.filters.length - 1) {\n      this.filters.splice(i, 1)\n      this.filters.splice(i + 1, 0, filter)\n    }\n  }\n\n  addFilterHandler (filter) {\n    this.filters.push(this.convertIncomingFilter(filter))\n  }\n\n  process (imageData, { loudness, samples }) {\n    let filters\n    try {\n      // Strip the leading filterId element from this.filters and eval the\n      // params strings.\n      filters = this.filters.map(([, name, fn, paramsArr]) => {\n        // Special case audioPlot that needs samples array as its sole argument.\n        if (name === \"audioPlot\") {\n          paramsArr = samples\n        } else {\n          paramsArr = evalParamsArr(paramsArr, { loudness, samples })\n        }\n        return [ fn, paramsArr ]\n      })\n    }\n    catch (e) {\n      return\n    }\n    imageData = (this.useGPU ? _lib_gpuFilters_js__WEBPACK_IMPORTED_MODULE_4__ : _lib_filters_js__WEBPACK_IMPORTED_MODULE_3__)\n      .applyFilters(filters, imageData)\n    this.canvasCtx.putImageData(imageData, 0, 0)\n  }\n}\n\n\ncustomElements.define(\"image-processor\", ImageProcessor)\n\n\n//# sourceURL=webpack:///./components/ImageProcessor.js?");

/***/ }),

/***/ "./components/VideoCanvas.js":
/*!***********************************!*\
  !*** ./components/VideoCanvas.js ***!
  \***********************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return VideoCanvas; });\n/* harmony import */ var _Base_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Base.js */ \"./components/Base.js\");\n/* harmony import */ var _lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../lib/domHelpers.js */ \"./lib/domHelpers.js\");\n\n\n\n\n\nconst STYLE = `\n  canvas {\n    display: none;\n  }\n`\n\n\nclass VideoCanvas extends _Base_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"] {\n  connectedCallback () {\n    super.connectedCallback(STYLE)\n\n    this.deviceId = this.getAttribute(\"deviceId\") || undefined\n    this.width = parseInt(this.getAttribute(\"width\") || \"1280\")\n    this.height = parseInt(this.getAttribute(\"height\") || \"720\")\n\n    this.video = Object(_lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_1__[\"Element\"])(\n      `<video width=\"${this.width}\" height=\"${this.height}\" autoplay=\"true\" muted>\n       </video>\n      `\n    )\n    this.shadow.appendChild(this.video)\n\n    this.canvas = Object(_lib_domHelpers_js__WEBPACK_IMPORTED_MODULE_1__[\"Element\"])(\n      `<canvas width=\"${this.width}\" height=\"${this.height}\">\n       </canvas>\n      `\n    )\n    this.shadow.appendChild(this.canvas)\n    this.canvasCtx = this.canvas.getContext(\"2d\")\n\n    // Start the audio/video input stream.\n    const constraints = {\n      audio: true,\n      video: {\n        width: this.width,\n        height: this.height,\n      }\n    }\n    if (this.deviceId !== undefined) {\n        constraints.video.deviceId = { exact: this.deviceId }\n    }\n    navigator\n      .mediaDevices.getUserMedia(constraints)\n      .then(stream => this.shadow.querySelector(\"video\").srcObject = stream)\n\n    // Get the audio stream.\n    // from: https://stackoverflow.com/a/52400024/2327940\n    const audioCtx = new AudioContext()\n    const sourceNode = audioCtx.createMediaElementSource(this.video)\n\n    // Create an audioAnalyzer node for reading audio data.\n    this.audioAnalyser = audioCtx.createAnalyser()\n    sourceNode.connect(this.audioAnalyser)\n    const dest = audioCtx.createMediaStreamDestination()\n    this.audioAnalyser.connect(dest)\n\n    // Uncomment to hear the audio in realtime.\n    //sourceNode.connect(audioCtx.destination);\n    this.audioTrack = dest.stream.getAudioTracks()[0]\n  }\n\n  captureFrame () {\n    // Capture a video frame onto othe canvas and return the corresponding ImageData\n    // object.\n    const { video, canvas, canvasCtx } = this\n    canvasCtx.drawImage(video, 0, 0, canvas.width, canvas.height)\n    return canvasCtx.getImageData(0, 0, canvas.width, canvas.height)\n  }\n\n}\n\n\ncustomElements.define(\"video-canvas\", VideoCanvas)\n\n\n//# sourceURL=webpack:///./components/VideoCanvas.js?");

/***/ }),

/***/ "./lib/audio.js":
/*!**********************!*\
  !*** ./lib/audio.js ***!
  \**********************/
/*! exports provided: getAudioParams */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getAudioParams\", function() { return getAudioParams; });\n\nfunction getTriggeredAudioBuffer (audioBuffer) {\n  /*\n     Return a subarray of audioBuffer that starts at some detected\n     trigger point.\n   */\n  // Find the index, not greater than TRIGGER_MAX_I, of the first run\n  // of samples in audioBuffer that is above TRIGGER_LEVEL for at least\n  // TRIGGER_NUM_RISING samples and return an audioBuffer subarray that\n  // starts there.\n  const TRIGGER_LEVEL = 128\n  const TRIGGER_NUM_RISING = 8\n  const TRIGGER_MAX_I = 512\n  let numRising = 0\n  let lastSample = audioBuffer[0]\n  for (let i = 1; i < TRIGGER_MAX_I; i += 1) {\n    const sample = audioBuffer[i]\n    if (sample < lastSample) {\n      // Reset the rising counter on any falling edge.\n      numRising = 0\n    } else if (lastSample > 128 && sample > lastSample) {\n      numRising += 1\n      if (numRising === TRIGGER_NUM_RISING) {\n        audioBuffer = audioBuffer.subarray(i - TRIGGER_NUM_RISING, audioBuffer.length)\n        break\n      }\n    }\n    lastSample = sample\n  }\n  return audioBuffer\n}\n\n\nfunction getAudioParams (audioAnalyser, audioBuffer, numSamples) {\n  // Get the audio sample data.\n  audioAnalyser.getByteTimeDomainData(audioBuffer)\n  audioBuffer = getTriggeredAudioBuffer(audioBuffer)\n\n  // Calculate the average loudness as a float in the range 0 - 1\n  const positiveAudioSamples = audioBuffer.filter(x => x > 128)\n  const normalizedLoudness = !positiveAudioSamples.length\n    ? 0\n    : positiveAudioSamples.reduce((acc, x) => acc + (x - 128) / 128, 0) / positiveAudioSamples.length\n\n  // Scale the audio samples to floats in the range 0 - 1 and scale the number of samples\n  // to numSamples.\n  const normalizedSamples = new Array(...audioBuffer).map(x => x / 255)\n  let scaledNormalizedSamples = []\n  const idxFactor = Math.floor(normalizedSamples.length / numSamples)\n  for (let i = 0; i < numSamples; i += 1) {\n    scaledNormalizedSamples.push(normalizedSamples[i * idxFactor])\n  }\n\n  return {\n    loudness: normalizedLoudness,\n    samples: scaledNormalizedSamples\n  }\n}\n\n\n//# sourceURL=webpack:///./lib/audio.js?");

/***/ }),

/***/ "./lib/canvasRecorder.js":
/*!*******************************!*\
  !*** ./lib/canvasRecorder.js ***!
  \*******************************/
/*! exports provided: default */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"default\", function() { return CanvasRecorder; });\n\nclass CanvasRecorder extends MediaRecorder {\n  constructor (canvas, audioTrack = null, frameRate = 30, mimeType = \"video/webm\") {\n    // Firefox will throw an error if the context isn't initialized before\n    // calling captureStream(), so let's do that.\n    canvas.getContext(\"2d\")\n    const stream = canvas.captureStream(frameRate)\n\n    if (audioTrack) {\n      stream.addTrack(audioTrack)\n    }\n\n    super(stream, { mimeType })\n    this.chunks = []\n\n    this.addEventListener(\"dataavailable\", e => this.chunks.push(e.data))\n    this.addEventListener(\"stop\", e => {\n      // Delay for a short time to allow the remaining video segment chunks\n      // to stream in.\n      window.setTimeout(\n        () => {\n          // Get the data blob, clear the chunks, and create/click-on an anchor\n          // element to download the blob.\n          const blob = new Blob(this.chunks, { type: this.mimeType })\n          this.chunks = []\n          const a = document.createElement(\"a\")\n          a.href = URL.createObjectURL(blob)\n          a.download = `recording_${ Date.now() }`\n          a.click()\n        }, this.timeslice\n      )\n    })\n  }\n\n  start (timeslice = 1000) {\n    this.timeslice = timeslice\n    super.start(timeslice)\n  }\n}\n\n\n//# sourceURL=webpack:///./lib/canvasRecorder.js?");

/***/ }),

/***/ "./lib/constants.js":
/*!**************************!*\
  !*** ./lib/constants.js ***!
  \**************************/
/*! exports provided: FILTER_PRESET_NAMES, FILTER_PRESETS, TOPICS, FILTER_NAME_PARAM_DEFAULT_MAP */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FILTER_PRESET_NAMES\", function() { return FILTER_PRESET_NAMES; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FILTER_PRESETS\", function() { return FILTER_PRESETS; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"TOPICS\", function() { return TOPICS; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"FILTER_NAME_PARAM_DEFAULT_MAP\", function() { return FILTER_NAME_PARAM_DEFAULT_MAP; });\n\nconst FILTER_PRESET_NAMES = [\n  \"Default\",\n  \"Holy Mountain\",\n  \"Distant Digits\",\n  \"2001\",\n]\nconst FILTER_PRESETS = {\n  get: name => {\n    switch (name) {\n        case \"Default\":\n        return [\n          [ 0, \"brightness\", { factor: \"loudness * 10\" } ],\n          [ 1, \"colorGain\", { r: \"Math.max(loudness * 10, 1)\", g: \"1\", b: \"1\" } ],\n          [ 2, \"invert\", { } ],\n          [ 3, \"rowBlanker\", { nth: \"Math.max(Math.floor(Math.random() * 200), 2)\" } ],\n          [ 4, \"panZoom\", { x: 0, y: 0, zoom: \"Math.max(1, loudness * 10)\" } ],\n        ]\n        break\n\n      case \"Holy Mountain\":\n        return [\n          [ 0, \"threshold\", { threshold: \"255 - loudness * 2 * 255\" } ],\n          [ 1, \"brightness\", { factor: \"loudness * 3\" } ],\n          [ 2, \"invert\", { } ],\n          [ 3, \"audioPlot\", { } ],\n          [ 4, \"verticalMirror\", { } ],\n          [ 5, \"horizontalMirror\", { } ],\n        ]\n        break\n\n      case \"Distant Digits\":\n        return [\n          [ 0, \"rowBlanker\", { nth: \"5\" } ],\n          [ 1, \"colorGain\", { r: \"2\", g: \"0\", b: \"0\" } ],\n          [ 2, \"threshold\", { threshold: \"100\" } ],\n          [ 3, \"invert\", { } ],\n        ]\n        break\n\n      case \"2001\":\n        return [\n          [ 0, \"verticalMirror\", { } ],\n          [ 1, \"horizontalMirror\", { } ],\n          [ 2, \"colorReducer\", { mask: \"128\" } ],\n          [ 3, \"brightness\", { factor: \"1\" } ],\n        ]\n        break\n    }\n  }\n}\n\n\nconst TOPICS = Object.freeze(\n  Object.fromEntries(\n    [\n      \"ADD_FEED\",\n      \"ADD_FILTER\",\n      \"FEED_ADDED\",\n      \"FILTER_CHANGE\",\n      \"FULLSCREEN_TOGGLE\",\n      \"MOVE_FILTER_DOWN\",\n      \"MOVE_FILTER_UP\",\n      \"PARAMS_UPDATE\",\n      \"PRESET_CHANGE\",\n      \"RECORD_START\",\n      \"RECORD_STOP\",\n      \"REMOVE_FILTER\",\n      \"SWITCH_FEED\",\n    ].map(x => [ x, x ])\n  )\n)\n\n// Define default param values to use when adding a new filter to the chain.\nconst FILTER_NAME_PARAM_DEFAULT_MAP = new Map([\n  [ \"threshold\", { threshold: 100 } ],\n  [ \"brightness\", { factor: 1 } ],\n  [ \"channel\", { r: 1, g: 1, b: 1 } ],\n  [ \"colorGain\", { r: 1, g: 1, b: 1 } ],\n  [ \"colorReducer\", { mask: 0x88 } ],\n  [ \"rowBlanker\", { nth: 2 } ],\n  [ \"colBlanker\", { nth: 2 } ],\n  [ \"invert\", {} ],\n  [ \"audioPlot\", {} ],\n  [ \"flipHorizontal\", {} ],\n  [ \"verticalMirror\", {} ],\n  [ \"horizontalMirror\", {} ],\n  [ \"blur\", { level: 5 } ],\n  [ \"panZoom\", { x: 0, y: 0, zoom: 2 } ],\n])\n\n\n//# sourceURL=webpack:///./lib/constants.js?");

/***/ }),

/***/ "./lib/domHelpers.js":
/*!***************************!*\
  !*** ./lib/domHelpers.js ***!
  \***************************/
/*! exports provided: Element, getMaxZIndex */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"Element\", function() { return Element; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getMaxZIndex\", function() { return getMaxZIndex; });\n\nfunction Element (tagNameOrDOMString, wrapperTag = \"div\") {\n  // Return a new Element for a given tag name or DOM string.\n  const s = tagNameOrDOMString.trim()\n  if (!s.startsWith(\"<\")) {\n    return document.createElement(s)\n  }\n  const wrapper = document.createElement(wrapperTag)\n  wrapper.innerHTML = s.trim()\n  const el = wrapper.firstChild\n  if (el.nodeName === \"#text\") {\n    throw new Error(\n      `Element creation failed. Maybe ${wrapperTag} is not a valid parent for: ${s}`\n    )\n  }\n  wrapper.removeChild(el)\n  return el\n}\n\n\nfunction getMaxZIndex () {\n  // Adapted from: https://dash.cloudflare.com/apps/developer/docs/techniques/styles#z-indexes\n  let max = 0\n  const elements = document.getElementsByTagName(\"*\")\n  Array.prototype.slice.call(elements).forEach(element => {\n    const zIndex = parseInt(\n      document.defaultView.getComputedStyle(element).zIndex,\n      10\n    )\n    max = zIndex ? Math.max(max, zIndex) : max\n  })\n  return max\n}\n\n\n//# sourceURL=webpack:///./lib/domHelpers.js?");

/***/ }),

/***/ "./lib/filters.js":
/*!************************!*\
  !*** ./lib/filters.js ***!
  \************************/
/*! exports provided: calcPixelBrightness, clamp8, convertPositionToIndex, applyFilters, thresholdFilter, brightnessFilter, channelFilter, colorGainFilter, colorReducerFilter, rowBlankerFilter, colBlankerFilter, invertFilter, audioPlotFilter, flipHorizontalFilter, verticalMirrorFilter, horizontalMirrorFilter, blurFilter, panZoomFilter */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"calcPixelBrightness\", function() { return calcPixelBrightness; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"clamp8\", function() { return clamp8; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"convertPositionToIndex\", function() { return convertPositionToIndex; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"applyFilters\", function() { return applyFilters; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"thresholdFilter\", function() { return thresholdFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"brightnessFilter\", function() { return brightnessFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"channelFilter\", function() { return channelFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"colorGainFilter\", function() { return colorGainFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"colorReducerFilter\", function() { return colorReducerFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"rowBlankerFilter\", function() { return rowBlankerFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"colBlankerFilter\", function() { return colBlankerFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"invertFilter\", function() { return invertFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"audioPlotFilter\", function() { return audioPlotFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"flipHorizontalFilter\", function() { return flipHorizontalFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"verticalMirrorFilter\", function() { return verticalMirrorFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"horizontalMirrorFilter\", function() { return horizontalMirrorFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"blurFilter\", function() { return blurFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"panZoomFilter\", function() { return panZoomFilter; });\n\n///////////////////////////////////////////////////////////////////////////////\n// Utility Functions\n///////////////////////////////////////////////////////////////////////////////\n\n// from: https://stackoverflow.com/a/596241\nfunction calcPixelBrightness (pixel) {\n  return pixel[0] * 0.299 + pixel[1] * 0.587 + pixel[2] * 0.114 * (pixel[3] / 255)\n}\n\n\nfunction clamp8 (x) {\n  return Math.max(Math.min(x, 255), 0)\n}\n\nfunction convertPositionToIndex(col, row, width, height) {\n  return 4 * (col + width * (height - 1 - row))\n}\n\nfunction* pixelIterator (imageData) {\n  const maxI = (imageData.width - 1) * (imageData.height - 1) * 4\n  const data = imageData.data\n  let row = imageData.height - 1\n  let col = 0\n  for (let i = 0; i <= maxI; i += 4) {\n    const pixel = [ data[i], data[i + 1], data[i + 2], data[i + 3] ]\n    yield [ i, col, row, pixel ]\n    col += 1\n    if (col === imageData.width) {\n      row -= 1\n      col = 0\n    }\n  }\n}\n\nfunction applyFilters (filters, imageData) {\n  // Define which filter functions require the use of a frame buffer\n  // that mimics the way the GPU filters work to avoid mutating a single\n  // data array.\n  const FRAME_BUFFER_FILTERS = [\n    flipHorizontalFilter,\n    verticalMirrorFilter,\n    horizontalMirrorFilter,\n    panZoomFilter,\n  ]\n  for (let [ filter, params ] of filters) {\n    const useFrameBuffer = FRAME_BUFFER_FILTERS.includes(filter)\n    const workingImageData = useFrameBuffer ? new ImageData(imageData.width, imageData.height) : imageData\n    for (let [ i, col, row, pixel] of pixelIterator(imageData)) {\n      pixel = filter(pixel, params, i, col, row, imageData.data, imageData.width, imageData.height)\n      workingImageData.data[i] = pixel[0]\n      workingImageData.data[i + 1] = pixel[1]\n      workingImageData.data[i + 2] = pixel[2]\n      workingImageData.data[i + 3] = pixel[3]\n    }\n    imageData = workingImageData\n  }\n  return imageData\n}\n\n\n///////////////////////////////////////////////////////////////////////////////\n// Filter Functions\n///////////////////////////////////////////////////////////////////////////////\n\n\n// Threshold Filter\n\nfunction thresholdFilter (pixel, params, i, col, row, data, width, height) {\n  const [ threshold ] = params\n  const brightness = calcPixelBrightness(pixel)\n  if (brightness >= threshold) {\n    pixel = [ 255, 255, 255, 255 ]\n  }\n  return pixel\n}\n\n\n// Brightness Filter\n\nfunction brightnessFilter (pixel, params, i, col, row, data, width, height) {\n  let [ r, g, b, a ] = pixel\n  const [ factor ] = params\n  r = clamp8(r + r * factor)\n  g = clamp8(g + g * factor)\n  b = clamp8(b + b * factor)\n  return [ r, g, b, a ]\n}\n\n\n// Channel Filter\n\nfunction channelFilter (pixel, params, i, col, row, data, width, height) {\n  const [ keepR, keepG, keepB ] = params\n  pixel[0] = keepR === 0 ? 0 : pixel[0]\n  pixel[1] = keepG === 0 ? 0 : pixel[1]\n  pixel[2] = keepB === 0 ? 0 : pixel[2]\n  return pixel\n}\n\n\n// Color Gain Filter\n\nfunction colorGainFilter (pixel, params, i, col, row, data, width, height) {\n  let [ r, g, b, a ] = pixel\n  const [ rGain, gGain, bGain ] = params\n  r = clamp8(r + r * rGain)\n  g = clamp8(g + g * gGain)\n  b = clamp8(b + b * bGain)\n  return [ r, g, b, a ]\n}\n\n\n\n// Color Reducer Filter\n\nfunction colorReducerFilter (pixel, params, i, col, row, data, width, height) {\n  let [ r, g, b, a ] = pixel\n  const [ mask ] = params\n  r = r & mask\n  g = g & mask\n  b = b & mask\n  return [ r, g, b, a ]\n}\n\n\n// Row Blanker Filter\n\nfunction rowBlankerFilter (pixel, params, i, col, row, data, width, height) {\n  const [ nth ] = params\n  return row % nth === 0 ? [0, 0, 0, 255] : pixel\n}\n\n\n// Col Blanker Filter\n\nfunction colBlankerFilter (pixel, params, i, col, row, data, width, height) {\n  const [ nth ] = params\n  return col % nth === 0 ? [0, 0, 0, 255] : pixel\n}\n\n\n// Invert Filter\n\nfunction invertFilter (pixel, params, i, col, row, data, width, height) {\n  let [ r, g, b, a ] = pixel\n  return [ 255 - r, 255 - g, 255 - b, a ]\n}\n\n\n// Y-Plot Filter\n\nfunction audioPlotFilter (pixel, params, i, col, row, data, width, height) {\n  // params is an array of audio samples in the range 0 - 1.\n  const [ r, g, b, a ] = pixel\n  const d = ((row / height) >= params[col]) ? 64 : -64\n  return [ clamp8(r + d), clamp8(g + d), 255 - b, a ]\n}\n\n\n// Flip Horizontal Filter\n\nfunction flipHorizontalFilter (pixel, params, i, col, row, data, width, height) {\n  i = 4 * (width - 1 - col + width * (height - row))\n  pixel = [ data[i], data[i + 1], data[i + 2], data[i + 3] ]\n  return pixel\n}\n\n\n// Vertical Mirror Filter\n\nfunction verticalMirrorFilter (pixel, params, i, col, row, data, width, height) {\n  const middleRow = Math.floor(height / 2)\n  if (row >= middleRow) {\n    i = 4 * (col + width * row)\n  }\n  pixel = [ data[i], data[i + 1], data[i + 2], data[i + 3] ]\n  return pixel\n}\n\n\n// Horizontal Mirror Filter\n\nfunction horizontalMirrorFilter (pixel, params, i, col, row, data, width, height) {\n  const middleCol = Math.floor(width / 2)\n  if (col >= middleCol) {\n    i = 4 * (middleCol - col - middleCol + width * (height - 1 - row))\n  }\n  pixel = [ data[i], data[i + 1], data[i + 2], data[i + 3] ]\n  return pixel\n}\n\n\n// Blur Filter\n\nfunction blurFilter (pixel, params, i, col, row, data, width, height) {\n  let [ level ] = params\n\n  for (let lev = level; lev > 0; lev -= 1) {\n    let nCol = col - lev\n    if (nCol >= 0 && nCol < width) {\n      i = convertPositionToIndex(nCol, row, width, height)\n      pixel[0] += data[i]\n      pixel[1] += data[i + 1]\n      pixel[2] += data[i + 2]\n      pixel[3] += data[i + 3]\n    }\n\n    nCol = col + lev\n    if (nCol >= 0 && nCol < width) {\n      i = convertPositionToIndex(nCol, row, width, height)\n      pixel[0] += data[i]\n      pixel[1] += data[i + 1]\n      pixel[2] += data[i + 2]\n      pixel[3] += data[i + 3]\n    }\n  }\n\n  const numPixels = level * 2 + 1\n\n  pixel = [\n    Math.floor(pixel[0] / numPixels),\n    Math.floor(pixel[1] / numPixels),\n    Math.floor(pixel[2] / numPixels),\n    Math.floor(pixel[3] / numPixels),\n  ]\n\n  return pixel\n}\n\n\n// Pan + Zoom Filter\n\nfunction panZoomFilter (pixel, params, i, col, row, data, width, height) {\n  const [ x, y, zoom ] = params\n\n  col = Math.floor((col + x) / zoom + (width - width / zoom) / 2)\n  if (col >= width) {\n    col -= width\n  }\n\n  row = Math.floor((row + y) / zoom + (height - height / zoom) / 2)\n  if (row >= height) {\n    row -= height\n  }\n\n  i = convertPositionToIndex(col, row, width, height)\n  pixel = [ data[i], data[i+1], data[i+2], data[i+3] ]\n\n  return pixel\n}\n\n\n//# sourceURL=webpack:///./lib/filters.js?");

/***/ }),

/***/ "./lib/gpuFilters.js":
/*!***************************!*\
  !*** ./lib/gpuFilters.js ***!
  \***************************/
/*! exports provided: applyFilters, thresholdFilter, brightnessFilter, channelFilter, colorGainFilter, colorReducerFilter, rowBlankerFilter, colBlankerFilter, invertFilter, audioPlotFilter, flipHorizontalFilter, verticalMirrorFilter, horizontalMirrorFilter, blurFilter, panZoomFilter */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"applyFilters\", function() { return applyFilters; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"thresholdFilter\", function() { return thresholdFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"brightnessFilter\", function() { return brightnessFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"channelFilter\", function() { return channelFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"colorGainFilter\", function() { return colorGainFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"colorReducerFilter\", function() { return colorReducerFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"rowBlankerFilter\", function() { return rowBlankerFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"colBlankerFilter\", function() { return colBlankerFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"invertFilter\", function() { return invertFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"audioPlotFilter\", function() { return audioPlotFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"flipHorizontalFilter\", function() { return flipHorizontalFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"verticalMirrorFilter\", function() { return verticalMirrorFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"horizontalMirrorFilter\", function() { return horizontalMirrorFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"blurFilter\", function() { return blurFilter; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"panZoomFilter\", function() { return panZoomFilter; });\n/* harmony import */ var _filters_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./filters.js */ \"./lib/filters.js\");\n\n\n\n\nconst gpu = new GPU()\n\n\n///////////////////////////////////////////////////////////////////////////////\n// General Utility Functions\n///////////////////////////////////////////////////////////////////////////////\n\nfunction applyFilters(filters, imageData) {\n  const numFilters = filters.length\n  let data = imageData.data\n  for (let i = 0; i < numFilters; i += 1) {\n    const [ filter, params ] = filters[i]\n    filter.setOutput([ imageData.width, imageData.height ])\n    filter.setConstants({\n      width: imageData.width,\n      height: imageData.height,\n    })\n    // gpu.js doesn't like when params is an empty array, so make it non-empty.\n    filter(data, params.length ? params : [0])\n    data = filter.getPixels()\n  }\n  return new ImageData(data, imageData.width, imageData.height)\n}\n\n\n///////////////////////////////////////////////////////////////////////////////\n// Kernel Utility Functions\n///////////////////////////////////////////////////////////////////////////////\n\n// The \"this\" in these functions will resolve to the kernel that calls it.\n\n\nfunction getContext () {\n  const col = this.thread.x\n  const row = this.thread.y\n  // Convert position to index.\n  const i = 4 * (col + this.constants.width * (this.constants.height - 1 - row))\n  return [ i, col, row ]\n}\n\n\nfunction setColor (pixel) {\n  const [ r, g, b, a ] = pixel\n  this.color(r / 255, g / 255, b / 255, a / 255)\n}\n\n\n///////////////////////////////////////////////////////////////////////////////\n// GPU-agnostic Filter Functions\n///////////////////////////////////////////////////////////////////////////////\n\n// Threshold Filter\n\nconst thresholdFilter = gpu.createKernel(function (data, params) {\n  const { width, height } = this.constants\n  const [ i, col, row ] = getContext()\n  const pixel = [ data[i], data[i+1], data[i+2], data[i+3] ]\n  setColor(thresholdFilter(pixel, params, i, col, row, 0, width, height))\n})\n  .setFunctions([ getContext, setColor, _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"calcPixelBrightness\"], _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"thresholdFilter\"] ])\n  .setDynamicOutput(true)\n  .setGraphical(true)\n\n\n// Brightness Filter\n\nconst brightnessFilter = gpu.createKernel(function (data, params) {\n  const { width, height } = this.constants\n  const [ i, col, row ] = getContext()\n  const pixel = [ data[i], data[i+1], data[i+2], data[i+3] ]\n  setColor(brightnessFilter(pixel, params, i, col, row, 0, width, height))\n})\n  .setFunctions([ getContext, setColor, _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"clamp8\"], _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"brightnessFilter\"] ])\n  .setDynamicOutput(true)\n  .setGraphical(true)\n\n\n// Channel Filter\n\nconst channelFilter = gpu.createKernel(function (data, params) {\n  const { width, height } = this.constants\n  const [ i, col, row ] = getContext()\n  const pixel = [ data[i], data[i+1], data[i+2], data[i+3] ]\n  setColor(channelFilter(pixel, params, i, col, row, 0, width, height))\n})\n  .setFunctions([ getContext, setColor, _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"channelFilter\"] ])\n  .setDynamicOutput(true)\n  .setGraphical(true)\n\n\n// Color Gain Filter\n\nconst colorGainFilter = gpu.createKernel(function (data, params) {\n  const { width, height } = this.constants\n  const [ i, col, row ] = getContext()\n  const pixel = [ data[i], data[i+1], data[i+2], data[i+3] ]\n  setColor(colorGainFilter(pixel, params, i, col, row, 0, width, height))\n})\n  .setFunctions([ getContext, setColor, _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"clamp8\"], _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"colorGainFilter\"] ])\n  .setDynamicOutput(true)\n  .setGraphical(true)\n\n\n// Color Reducer Filter\n\nconst colorReducerFilter = gpu.createKernel(function (data, params) {\n  const { width, height } = this.constants\n  const [ i, col, row ] = getContext()\n  const pixel = [ data[i], data[i+1], data[i+2], data[i+3] ]\n  setColor(colorReducerFilter(pixel, params, i, col, row, 0, width, height))\n})\n  .setFunctions([ getContext, setColor, _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"clamp8\"], _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"colorReducerFilter\"] ])\n  .setDynamicOutput(true)\n  .setGraphical(true)\n\n\n// Row Blanker Filter\n\nconst rowBlankerFilter = gpu.createKernel(function (data, params) {\n  const { width, height } = this.constants\n  const [ i, col, row ] = getContext()\n  const pixel = [ data[i], data[i+1], data[i+2], data[i+3] ]\n  setColor(rowBlankerFilter(pixel, params, i, col, row, 0, width, height))\n})\n  .setFunctions([ getContext, setColor, _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"clamp8\"], _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"rowBlankerFilter\"] ])\n  .setDynamicOutput(true)\n  .setGraphical(true)\n\n\n// Col Blanker Filter\n\nconst colBlankerFilter = gpu.createKernel(function (data, params) {\n  const { width, height } = this.constants\n   const [ i, col, row ] = getContext()\n  const pixel = [ data[i], data[i+1], data[i+2], data[i+3] ]\n  setColor(colBlankerFilter(pixel, params, i, col, row, 0, width, height))\n})\n  .setFunctions([ getContext, setColor, _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"clamp8\"], _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"colBlankerFilter\"] ])\n  .setDynamicOutput(true)\n  .setGraphical(true)\n\n\n// Invert Filter\n\nconst invertFilter = gpu.createKernel(function (data, params) {\n  const { width, height } = this.constants\n  const [ i, col, row ] = getContext()\n  const pixel = [ data[i], data[i+1], data[i+2], data[i+3] ]\n  setColor(invertFilter(pixel, params, i, col, row, 0, width, height))\n})\n  .setFunctions([ getContext, setColor, _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"invertFilter\"] ])\n  .setDynamicOutput(true)\n  .setGraphical(true)\n\n\n// Y-Plot Filter\n\nconst audioPlotFilter = gpu.createKernel(function (data, params) {\n  const { width, height } = this.constants\n  const [ i, col, row ] = getContext()\n  const pixel = [ data[i], data[i+1], data[i+2], data[i+3] ]\n  setColor(audioPlotFilter(pixel, params, i, col, row, 0, width, height))\n})\n  .setFunctions([ getContext, setColor, _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"clamp8\"], _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"audioPlotFilter\"] ])\n  .setDynamicOutput(true)\n  .setGraphical(true)\n\n\n///////////////////////////////////////////////////////////////////////////////\n//\n// GPU-specific Filter Functions\n//\n// These functions must have their logic implemented in the GPU kernel function\n// instead of leveraging FILTERS.* functions because they require access to\n// the entire `data` array, and it's not currently possible to pass this array\n// as an argument to an internal function.\n// See: https://github.com/gpujs/gpu.js/issues/394\n//\n///////////////////////////////////////////////////////////////////////////////\n\n// Flip Horizontal Filter\n\nconst flipHorizontalFilter = gpu.createKernel(function (data, params) {\n  const { width, height } = this.constants\n  const [ i, col, row ] = getContext()\n  i = 4 * (width - 1 - col + width * (height - row))\n  const pixel = [ data[i], data[i + 1], data[i + 2], data[i + 3] ]\n  setColor(pixel)\n})\n  .setFunctions([ getContext, setColor ])\n  .setDynamicOutput(true)\n  .setGraphical(true)\n\n\n// Vertical Mirror Filter\n\nconst verticalMirrorFilter = gpu.createKernel(function (data, params) {\n  const { width, height } = this.constants\n  const [ i, col, row ] = getContext()\n  const middleRow = Math.floor(height / 2)\n  if (row >= middleRow) {\n    i = 4 * (col + this.constants.width * row)\n  }\n  const pixel = [ data[i], data[i + 1], data[i + 2], data[i + 3] ]\n  setColor(pixel)\n})\n  .setFunctions([ getContext, setColor ])\n  .setDynamicOutput(true)\n  .setGraphical(true)\n\n\n// Horizontal Mirror Filter\n\nconst horizontalMirrorFilter = gpu.createKernel(function (data, params) {\n  const { width, height } = this.constants\n  const [ i, col, row ] = getContext()\n  const middleCol = Math.floor(width / 2)\n  if (col >= middleCol) {\n    i = 4 * (middleCol - col - middleCol + this.constants.width * (this.constants.height - 1 - row))\n  }\n  const pixel = [ data[i], data[i + 1], data[i + 2], data[i + 3] ]\n  setColor(pixel)\n})\n  .setFunctions([ getContext, setColor ])\n  .setDynamicOutput(true)\n  .setGraphical(true)\n\n\n// Blur Filter\n\nconst blurFilter = gpu.createKernel(function (data, params) {\n  const [ level ] = params\n  const { width, height } = this.constants\n  let [ i, col, row ] = getContext()\n\n  let pixel = [ data[i], data[i + 1], data[i + 2], data[i + 3] ]\n\n  for (let lev = level; lev > 0; lev -= 1) {\n    let nCol = col - lev\n    if (nCol >= 0 && nCol < width) {\n      i = convertPositionToIndex(nCol, row, width, height)\n      pixel[0] += data[i]\n      pixel[1] += data[i + 1]\n      pixel[2] += data[i + 2]\n      pixel[3] += data[i + 3]\n    }\n\n    nCol = col + lev\n    if (nCol >= 0 && nCol < width) {\n      i = convertPositionToIndex(nCol, row, width, height)\n      pixel[0] += data[i]\n      pixel[1] += data[i + 1]\n      pixel[2] += data[i + 2]\n      pixel[3] += data[i + 3]\n    }\n  }\n\n  const numPixels = level * 2 + 1\n\n  pixel = [\n    Math.floor(pixel[0] / numPixels),\n    Math.floor(pixel[1] / numPixels),\n    Math.floor(pixel[2] / numPixels),\n    Math.floor(pixel[3] / numPixels),\n  ]\n\n  setColor(pixel)\n})\n  .setFunctions([ getContext, setColor, _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"convertPositionToIndex\"] ])\n  .setDynamicOutput(true)\n  .setGraphical(true)\n\n\n// Pan + Zoom Filter\n\nconst panZoomFilter = gpu.createKernel(function (data, params) {\n  const [ x, y, zoom ] = params\n  const { width, height } = this.constants\n  let [ i, col, row ] = getContext()\n\n  col = Math.floor((col + x) / zoom + (width - width / zoom) / 2)\n  if (col >= width) {\n    col -= width\n  }\n\n  row = Math.floor((row + y) / zoom + (height - height / zoom) / 2)\n  if (row >= height) {\n    row -= height\n  }\n\n  i = convertPositionToIndex(col, row, width, height)\n  const pixel = [ data[i], data[i+1], data[i+2], data[i+3] ]\n\n  setColor(pixel)\n})\n  .setFunctions([ getContext, setColor, _filters_js__WEBPACK_IMPORTED_MODULE_0__[\"convertPositionToIndex\"] ])\n  .setDynamicOutput(true)\n  .setGraphical(true)\n\n\n//# sourceURL=webpack:///./lib/gpuFilters.js?");

/***/ }),

/***/ "./lib/pubSub.js":
/*!***********************!*\
  !*** ./lib/pubSub.js ***!
  \***********************/
/*! exports provided: subscribe, publish */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"subscribe\", function() { return subscribe; });\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"publish\", function() { return publish; });\n/* harmony import */ var _constants_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./constants.js */ \"./lib/constants.js\");\n\n\n\n\nconst TOPIC_SUBSCRIBERS_MAP = new Map(\n  Object.keys(_constants_js__WEBPACK_IMPORTED_MODULE_0__[\"TOPICS\"]).map(x => [ x, [] ])\n)\n\n\nconst subscribe = (topic, subscriber) =>\n  TOPIC_SUBSCRIBERS_MAP.get(topic).push(subscriber)\n\nasync function publish (topic, payload = {}) {\n  // Use JSON.stringify/parse to perform a deepcopy of the payload.\n  payload = JSON.stringify(payload)\n  for (let subscriber of TOPIC_SUBSCRIBERS_MAP.get(topic)) {\n    subscriber(JSON.parse(payload))\n  }\n}\n\n\n//# sourceURL=webpack:///./lib/pubSub.js?");

/***/ }),

/***/ "./lib/utils.js":
/*!**********************!*\
  !*** ./lib/utils.js ***!
  \**********************/
/*! exports provided: getFilterById */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"getFilterById\", function() { return getFilterById; });\n\nfunction getFilterById (filters, filterId) {\n  // Return the filter array with the specified ID and its index within filters.\n  let filtersWithIdx = filters\n    .map((filter, i) => [ filter, i ])\n    .filter(([ [ id ], i ]) => id === filterId)\n  if (filtersWithIdx.length === 0) {\n    console.warn(`No matching filter for idx: ${filterId}`)\n    return [ null, null ]\n  }\n  const [ filter, i ] = filtersWithIdx[0]\n  return [ filter, i ]\n}\n\n\n//# sourceURL=webpack:///./lib/utils.js?");

/***/ })

/******/ });</script></head>

  <body>
    <gritty-viddy width="1280" height="720"></gritty-viddy>
  </body>

</html>
